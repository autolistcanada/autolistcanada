<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <title>Listings Dashboard | AutoList Canada</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Leaflet CDN -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- Icons (Heroicons) -->
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    .leaflet-container { height: 320px; border-radius: 1rem; }
    .badge-cozy { background: #fbeee0; color: #b26d33; }
    .badge-minimalist { background: #e0f7fa; color: #00838f; }
    .badge-luxury { background: #f3e8ff; color: #7e22ce; }
    .badge-vintage { background: #ffecb3; color: #b45309; }
    .badge-sporty { background: #ede7f6; color: #4f46e5; }
    .modal-bg { background: rgba(0,0,0,0.4);}
    .map-legend-dot { width: 1rem; height: 1rem; border-radius: 9999px; display: inline-block; margin-right: 0.5rem; }
  </style>
</head>
<body class="h-full bg-gray-50 flex font-sans">

<!-- Sidebar -->
<aside class="w-64 min-h-screen bg-white border-r flex flex-col">
  <div class="flex items-center px-6 py-5 border-b">
    <img src="https://autolistcanada.ca/logo.png" alt="AutoList Canada Logo" class="h-10 w-10 rounded-full mr-3" onerror="this.style.display='none';">
    <span class="text-xl font-bold tracking-tight text-[#e11d48]">AutoList Canada</span>
  </div>
  <nav class="flex-1 py-6 px-4 space-y-1 text-gray-700">
    <a href="#" class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-100">
      <span data-feather="home" class="w-5 h-5 mr-3"></span> Home
    </a>
    <a href="#" class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-100">
      <span data-feather="bar-chart-2" class="w-5 h-5 mr-3"></span> Dashboard
    </a>
    <a href="#" class="flex items-center px-3 py-2 rounded-lg bg-[#f1f5f9] font-semibold text-[#e11d48]">
      <span data-feather="list" class="w-5 h-5 mr-3"></span> Listings
    </a>
    <a href="#" class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-100">
      <span data-feather="cpu" class="w-5 h-5 mr-3"></span> AI Tools
    </a>
    <a href="#" class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-100">
      <span data-feather="info" class="w-5 h-5 mr-3"></span> How It Works
    </a>
    <a href="#" class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-100">
      <span data-feather="help-circle" class="w-5 h-5 mr-3"></span> FAQ
    </a>
    <a href="#" class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-100">
      <span data-feather="upload" class="w-5 h-5 mr-3"></span> Import
    </a>
    <a href="#" class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-100">
      <span data-feather="file-text" class="w-5 h-5 mr-3"></span> Terms
    </a>
    <a href="#" class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-100">
      <span data-feather="shield" class="w-5 h-5 mr-3"></span> Privacy
    </a>
  </nav>
  <!-- Language Toggle -->
  <div class="px-4 py-3 border-t flex items-center justify-between">
    <button id="lang-en" class="flex items-center px-2 py-1 rounded bg-[#e11d48] text-white font-semibold text-sm focus:outline-none">
      <span class="mr-1">CA</span> ðŸ‡¨ðŸ‡¦ EN
    </button>
    <button id="lang-fr" class="flex items-center px-2 py-1 rounded text-[#e11d48] bg-white border border-[#e11d48] font-semibold text-sm focus:outline-none">
      ðŸ‡«ðŸ‡· FR
    </button>
  </div>
</aside>

<!-- Main Content -->
<main class="flex-1 flex flex-col min-h-screen">

  <!-- Top Bar: Search & Filters -->
  <header class="w-full border-b bg-white px-6 py-4 flex flex-col md:flex-row md:items-center gap-4 md:gap-6">
    <div class="flex-1 flex items-center gap-2">
      <input id="searchInput" type="text" placeholder="Search by titleâ€¦" class="w-64 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#e11d48]" />
      <select id="platformFilter" class="px-2 py-2 border rounded-lg focus:outline-none">
        <option value="">All Platforms</option>
        <option value="ebay">eBay</option>
        <option value="poshmark">Poshmark</option>
        <option value="facebook">Facebook</option>
      </select>
      <select id="toneFilter" class="px-2 py-2 border rounded-lg focus:outline-none">
        <option value="">All Buyer Intents</option>
        <option value="cozy">Cozy</option>
        <option value="minimalist">Minimalist</option>
        <option value="luxury">Luxury</option>
        <option value="vintage">Vintage</option>
        <option value="sporty">Sporty</option>
      </select>
      <label class="flex items-center ml-2 cursor-pointer select-none">
        <input id="hideSold" type="checkbox" class="mr-1 accent-[#e11d48]">
        <span class="text-sm">Hide Sold</span>
      </label>
      <div class="ml-4 flex items-center space-x-2">
        <button id="listViewBtn" class="p-2 rounded-lg border bg-[#e11d48]/10 text-[#e11d48]" title="List View">
          <span data-feather="list"></span>
        </button>
        <button id="gridViewBtn" class="p-2 rounded-lg border hover:bg-[#e11d48]/10 hover:text-[#e11d48]" title="Grid View">
          <span data-feather="grid"></span>
        </button>
      </div>
    </div>
    <!-- Connected Platforms -->
    <div class="flex items-center gap-3">
      <button id="btn-ebay" onclick="togglePlatform('ebay')" class="flex items-center px-3 py-2 rounded-lg border border-gray-200 bg-white shadow transition hover:bg-[#f4f4f6]">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/ebay.svg" class="w-5 h-5 mr-2" alt="eBay"> 
        <span>eBay</span>
        <span id="state-ebay" class="ml-2 text-green-600 font-medium hidden">âœ…</span>
      </button>
      <button id="btn-poshmark" onclick="togglePlatform('poshmark')" class="flex items-center px-3 py-2 rounded-lg border border-gray-200 bg-white shadow transition hover:bg-[#f4f4f6]">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/poshmark.svg" class="w-5 h-5 mr-2" alt="Poshmark">
        <span>Poshmark</span>
        <span id="state-poshmark" class="ml-2 text-green-600 font-medium hidden">âœ…</span>
      </button>
      <button id="btn-facebook" onclick="togglePlatform('facebook')" class="flex items-center px-3 py-2 rounded-lg border border-gray-200 bg-white shadow transition hover:bg-[#f4f4f6]">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/facebook.svg" class="w-5 h-5 mr-2" alt="Facebook">
        <span>Facebook</span>
        <span id="state-facebook" class="ml-2 text-green-600 font-medium hidden">âœ…</span>
      </button>
    </div>
  </header>

  <!-- Listings Table/Grid -->
  <section id="listingsSection" class="flex-1 px-6 py-6">

    <!-- List View (default) -->
    <div id="listView" class="block">
      <div class="bg-white shadow rounded-xl overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-5 py-3 text-left font-semibold">Image</th>
              <th class="px-5 py-3 text-left font-semibold">Title</th>
              <th class="px-5 py-3 text-left font-semibold">Actions</th>
              <th class="px-5 py-3 text-left font-semibold">SKU</th>
              <th class="px-5 py-3 text-left font-semibold">Price</th>
              <th class="px-5 py-3 text-left font-semibold">Platforms</th>
              <th class="px-5 py-3 text-left font-semibold">Tone</th>
            </tr>
          </thead>
          <tbody id="listingsTableBody" class="bg-white">
            <!-- Populated by JS -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Grid View (hidden by default) -->
    <div id="gridView" class="hidden">
      <div id="listingsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Populated by JS -->
      </div>
    </div>
  </section>

  <!-- Buyer Psychology Map -->
  <section class="px-6 pb-4">
    <div class="mb-2 flex items-center gap-4">
      <h2 class="text-lg font-bold text-gray-800">Buyer Psychology Map</h2>
      <div id="mapLegend" class="flex gap-3 bg-white rounded-lg px-3 py-2 shadow">
        <span><span class="map-legend-dot badge-cozy"></span>Cozy</span>
        <span><span class="map-legend-dot badge-minimalist"></span>Minimalist</span>
        <span><span class="map-legend-dot badge-luxury"></span>Luxury</span>
        <span><span class="map-legend-dot badge-vintage"></span>Vintage</span>
        <span><span class="map-legend-dot badge-sporty"></span>Sporty</span>
      </div>
    </div>
    <div id="psychologyMap" class="w-full"></div>
  </section>

  <!-- Footer -->
  <footer class="px-6 py-5 bg-white border-t flex flex-col md:flex-row items-center justify-between gap-4">
    <div class="flex gap-4">
      <img src="https://img.icons8.com/color/48/000000/verified-badge.png" alt="Trust" class="h-8" />
      <img src="https://img.icons8.com/color/48/000000/lock-2.png" alt="Privacy" class="h-8" />
      <img src="https://img.icons8.com/color/48/000000/brain.png" alt="Science" class="h-8" />
    </div>
    <div class="text-gray-500 text-sm text-center md:text-right">
      AutoList Canada Â© 2025 â€” Built with trust, science, and Canadian soul
    </div>
  </footer>

  <!-- AI Modals -->
  <div id="modal-bg" class="fixed inset-0 z-30 items-center justify-center hidden modal-bg">
    <div class="bg-white rounded-xl shadow-xl max-w-lg w-full mx-auto p-6 relative">
      <button aria-label="Close Modal" onclick="closeModal()" class="absolute top-2 right-2 p-2 text-gray-500 hover:text-[#e11d48]">
        <span data-feather="x"></span>
      </button>
      <div id="modal-content">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>
</main>

<script>
/** --- DATA --- */
const listings = [
  {
    id: 1,
    title: "Cozy Fleece Hoodie",
    image: "https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=facearea&w=96&q=80",
    sku: "CA-HOOD-101",
    price: 48.99,
    platforms: {ebay: true, poshmark: true, facebook: false},
    tone: "cozy",
    sold: false,
    description: "A soft, warm hoodie perfect for Canadian winters."
  },
  {
    id: 2,
    title: "Minimalist Desk Lamp",
    image: "https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=facearea&w=96&q=80",
    sku: "CA-LAMP-204",
    price: 69.00,
    platforms: {ebay: false, poshmark: false, facebook: true},
    tone: "minimalist",
    sold: false,
    description: "Modern, clean lines. Ideal for workspace focus."
  },
  {
    id: 3,
    title: "Luxury Leather Bag",
    image: "https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?auto=format&fit=facearea&w=96&q=80",
    sku: "CA-BAG-309",
    price: 225.50,
    platforms: {ebay: true, poshmark: true, facebook: true},
    tone: "luxury",
    sold: true,
    description: "Premium leather, expertly crafted for style and function."
  },
  {
    id: 4,
    title: "Vintage Denim Jacket",
    image: "https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=facearea&w=96&q=80",
    sku: "CA-JACKET-412",
    price: 110.00,
    platforms: {ebay: false, poshmark: true, facebook: true},
    tone: "vintage",
    sold: false,
    description: "Classic blue denim with a timeless cut."
  },
  {
    id: 5,
    title: "Sporty Running Shoes",
    image: "https://images.unsplash.com/photo-1519864600265-abb23847ef2c?auto=format&fit=facearea&w=96&q=80",
    sku: "CA-SHOE-555",
    price: 89.95,
    platforms: {ebay: false, poshmark: false, facebook: true},
    tone: "sporty",
    sold: false,
    description: "Lightweight, breathable shoes for active Canadians."
  }
];

// Buyer tone mapping to regions for map
const toneMap = {
  "cozy": {color: "#fbeee0", region: "Prairies", coords: [53.9333, -116.5765]}, // Alberta
  "minimalist": {color: "#e0f7fa", region: "British Columbia", coords: [53.7267, -127.6476]}, // BC
  "luxury": {color: "#f3e8ff", region: "Ontario", coords: [51.2538, -85.3232]}, // Ontario
  "vintage": {color: "#ffecb3", region: "Quebec", coords: [52.9399, -73.5491]}, // Quebec
  "sporty": {color: "#ede7f6", region: "Nova Scotia", coords: [44.6820, -63.7443]} // NS
};

let connectedPlatforms = { ebay: false, poshmark: false, facebook: false };
let currentView = "list"; // or 'grid'
let lang = "en";

/** --- RENDER FUNCTIONS --- */
function renderListings() {
  // Get filters
  const searchVal = document.getElementById('searchInput').value.toLowerCase();
  const platVal = document.getElementById('platformFilter').value;
  const toneVal = document.getElementById('toneFilter').value;
  const hideSold = document.getElementById('hideSold').checked;

  // Filter
  let filtered = listings.filter(item => {
    if (searchVal && !item.title.toLowerCase().includes(searchVal)) return false;
    if (platVal && !item.platforms[platVal]) return false;
    if (toneVal && item.tone !== toneVal) return false;
    if (hideSold && item.sold) return false;
    return true;
  });

  // List view
  const tbody = document.getElementById('listingsTableBody');
  tbody.innerHTML = '';
  filtered.forEach(item => {
    const row = document.createElement('tr');
    row.className = item.sold ? "bg-gray-100 opacity-60" : "hover:bg-gray-50";
    row.innerHTML = `
      <td class="px-5 py-4">
        <img src="${item.image}" class="w-12 h-12 rounded-lg object-cover" alt="Image"/>
      </td>
      <td class="px-5 py-4 font-medium">${item.title}</td>
      <td class="px-5 py-4 flex gap-2">
        <button onclick="editListing(${item.id})" class="text-blue-500 hover:text-blue-700" title="Edit"><span data-feather="edit-3"></span></button>
        <button onclick="deleteListing(${item.id})" class="text-red-500 hover:text-red-700" title="Delete"><span data-feather="trash-2"></span></button>
        <button onclick="openAIModal('suggestTitle', ${item.id})" class="text-[#e11d48]" title="AI Suggest Title"><span data-feather="zap"></span></button>
        <button onclick="openAIModal('fixDescription', ${item.id})" class="text-[#e11d48]" title="Fix Description"><span data-feather="message-square"></span></button>
      </td>
      <td class="px-5 py-4">${item.sku}</td>
      <td class="px-5 py-4">$${item.price.toFixed(2)}</td>
      <td class="px-5 py-4 flex gap-2">
        ${renderPlatformCheckbox('ebay', item)}
        ${renderPlatformCheckbox('poshmark', item)}
        ${renderPlatformCheckbox('facebook', item)}
      </td>
      <td class="px-5 py-4">
        <span class="px-3 py-1 rounded-full text-xs font-semibold badge-${item.tone} capitalize">${item.tone}</span>
      </td>
    `;
    tbody.appendChild(row);
  });

  // Grid view
  const grid = document.getElementById('listingsGrid');
  grid.innerHTML = '';
  filtered.forEach(item => {
    const card = document.createElement('div');
    card.className = `bg-white rounded-xl shadow hover:shadow-lg p-5 flex flex-col gap-3 transition ${item.sold ? "opacity-60 bg-gray-100" : ""}`;
    card.innerHTML = `
      <img src="${item.image}" class="w-full h-40 object-cover rounded-lg mb-2" alt="Image"/>
      <div class="flex justify-between items-center">
        <span class="font-semibold text-lg">${item.title}</span>
        <span class="px-3 py-1 rounded-full text-xs font-semibold badge-${item.tone} capitalize">${item.tone}</span>
      </div>
      <div class="flex items-center gap-2">
        ${renderPlatformCheckbox('ebay', item, true)}
        ${renderPlatformCheckbox('poshmark', item, true)}
        ${renderPlatformCheckbox('facebook', item, true)}
      </div>
      <div class="flex items-center justify-between">
        <span class="text-gray-500 text-sm">${item.sku}</span>
        <span class="font-bold text-[#e11d48] text-lg">$${item.price.toFixed(2)}</span>
      </div>
      <div class="flex gap-2">
        <button onclick="editListing(${item.id})" class="text-blue-500 hover:text-blue-700" title="Edit"><span data-feather="edit-3"></span></button>
        <button onclick="deleteListing(${item.id})" class="text-red-500 hover:text-red-700" title="Delete"><span data-feather="trash-2"></span></button>
        <button onclick="openAIModal('suggestTitle', ${item.id})" class="text-[#e11d48]" title="AI Suggest Title"><span data-feather="zap"></span></button>
        <button onclick="openAIModal('fixDescription', ${item.id})" class="text-[#e11d48]" title="Fix Description"><span data-feather="message-square"></span></button>
      </div>
    `;
    grid.appendChild(card);
  });

  feather.replace();
}

function renderPlatformCheckbox(platform, item, gridView=false) {
  const logos = {
    ebay: '<img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/ebay.svg" class="w-5 h-5 inline" alt="eBay">',
    poshmark: '<img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/poshmark.svg" class="w-5 h-5 inline" alt="Poshmark">',
    facebook: '<img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/facebook.svg" class="w-5 h-5 inline" alt="Facebook">'
  };
  return `
    <label class="flex items-center gap-1 cursor-pointer select-none">
      <input type="checkbox" ${item.platforms[platform] ? 'checked' : ''} onclick="toggleListingPlatform(${item.id},'${platform}')" class="accent-[#e11d48]">
      ${logos[platform]}
      ${!gridView ? `<span class="sr-only">${platform}</span>` : ''}
    </label>
  `;
}

/** --- PLATFORM TOGGLE BUTTONS --- */
function togglePlatform(platform) {
  connectedPlatforms[platform] = !connectedPlatforms[platform];
  document.getElementById(`state-${platform}`).classList.toggle('hidden', !connectedPlatforms[platform]);
  document.getElementById(`btn-${platform}`).classList.toggle('border-[#e11d48]', connectedPlatforms[platform]);
  document.getElementById(`btn-${platform}`).classList.toggle('bg-[#e11d48]/10', connectedPlatforms[platform]);
}

function toggleListingPlatform(id, platform) {
  const item = listings.find(l => l.id === id);
  if (item) {
    item.platforms[platform] = !item.platforms[platform];
    renderListings();
  }
}

/** --- VIEW SWITCHER --- */
document.getElementById('listViewBtn').onclick = () => {
  currentView = 'list';
  document.getElementById('listView').classList.remove('hidden');
  document.getElementById('gridView').classList.add('hidden');
  document.getElementById('listViewBtn').classList.add('bg-[#e11d48]/10','text-[#e11d48]');
  document.getElementById('gridViewBtn').classList.remove('bg-[#e11d48]/10','text-[#e11d48]');
};
document.getElementById('gridViewBtn').onclick = () => {
  currentView = 'grid';
  document.getElementById('listView').classList.add('hidden');
  document.getElementById('gridView').classList.remove('hidden');
  document.getElementById('gridViewBtn').classList.add('bg-[#e11d48]/10','text-[#e11d48]');
  document.getElementById('listViewBtn').classList.remove('bg-[#e11d48]/10','text-[#e11d48]');
};

/** --- FILTERS --- */
document.getElementById('searchInput').addEventListener('input', renderListings);
document.getElementById('platformFilter').addEventListener('change', renderListings);
document.getElementById('toneFilter').addEventListener('change', renderListings);
document.getElementById('hideSold').addEventListener('change', renderListings);

/** --- AI MODALS --- */
function openAIModal(type, id) {
  const item = listings.find(l => l.id === id);
  let title, content;
  if (type === "suggestTitle") {
    title = "AI Suggest Title";
    content = `
      <h3 class="text-xl font-bold mb-3">${title}</h3>
      <p>Original: <span class="font-mono text-gray-500">${item.title}</span></p>
      <div class="my-3">
        <label class="block mb-1 text-sm font-medium">AI Suggestion:</label>
        <input type="text" class="w-full px-3 py-2 border rounded-lg focus:outline-none" value="${aiSuggestTitle(item)}"/>
      </div>
      <div class="flex gap-2 mt-4 justify-end">
        <button onclick="closeModal()" class="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300">Cancel</button>
        <button onclick="applyAISuggestion(${id}, 'title')" class="px-4 py-2 rounded bg-[#e11d48] text-white font-semibold">Apply</button>
      </div>
    `;
  } else if (type === "fixDescription") {
    title = "AI Fix Description";
    content = `
      <h3 class="text-xl font-bold mb-3">${title}</h3>
      <p>Original:<br> <span class="block text-gray-500 mb-2">${item.description}</span></p>
      <div class="my-3">
        <label class="block mb-1 text-sm font-medium">AI Suggestion:</label>
        <textarea class="w-full px-3 py-2 border rounded-lg focus:outline-none" rows="3">${aiFixDescription(item)}</textarea>
      </div>
      <div class="flex gap-2 mt-4 justify-end">
        <button onclick="closeModal()" class="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300">Cancel</button>
        <button onclick="applyAISuggestion(${id}, 'description')" class="px-4 py-2 rounded bg-[#e11d48] text-white font-semibold">Apply</button>
      </div>
    `;
  }
  document.getElementById('modal-content').innerHTML = content;
  document.getElementById('modal-bg').classList.remove('hidden');
}
function closeModal() {
  document.getElementById('modal-bg').classList.add('hidden');
}
function applyAISuggestion(id, field) {
  const item = listings.find(l => l.id === id);
  if (field === 'title') {
    const val = document.querySelector('#modal-content input').value;
    item.title = val;
  } else if (field === 'description') {
    const val = document.querySelector('#modal-content textarea').value;
    item.description = val;
  }
  closeModal();
  renderListings();
}
function aiSuggestTitle(item) {
  // "AI" logic: create a catchy, tone-appropriate title
  if (item.tone === 'cozy') return "Warmth in Every Thread: Fleece Hoodie";
  if (item.tone === 'minimalist') return "Sleek Minimalist Desk Lamp";
  if (item.tone === 'luxury') return "Opulent Leather Bag for Urban Life";
  if (item.tone === 'vintage') return "Authentic Vintage Denimâ€”Classic Style";
  if (item.tone === 'sporty') return "Run Free: Lightweight Sport Shoes";
  return item.title + " (AI)";
}
function aiFixDescription(item) {
  // "AI" logic: rewrite to be more engaging
  if (item.tone === 'cozy') return "Experience ultimate comfort with this super-soft fleece hoodie, tailored for warmth and style through Canadian winters.";
  if (item.tone === 'minimalist') return "Illuminate your space with a desk lamp designed for simplicity, focus, and elegance.";
  if (item.tone === 'luxury') return "Elevate your style and functionality with this exquisitely crafted luxury leather bag.";
  if (item.tone === 'vintage') return "Step back in time with this classic denim jacket, a true staple for any vintage lover.";
  if (item.tone === 'sporty') return "Boost your performance in these lightweight, breathable running shoes built for Canadian athletes.";
  return item.description;
}

/** --- EDIT/DELETE --- */
function editListing(id) {
  const item = listings.find(l => l.id === id);
  openAIModal('fixDescription', id); // For demo, just opens AI modal
}
function deleteListing(id) {
  if (confirm('Are you sure you want to delete this listing?')) {
    const idx = listings.findIndex(l => l.id === id);
    if (idx > -1) listings.splice(idx, 1);
    renderListings();
  }
}

/** --- LANGUAGE TOGGLE --- */
document.getElementById('lang-en').onclick = () => setLang('en');
document.getElementById('lang-fr').onclick = () => setLang('fr');
function setLang(l) {
  lang = l;
  document.getElementById('lang-en').classList.toggle('bg-[#e11d48]', l==='en');
  document.getElementById('lang-en').classList.toggle('text-white', l==='en');
  document.getElementById('lang-en').classList.toggle('bg-white', l==='fr');
  document.getElementById('lang-en').classList.toggle('text-[#e11d48]', l==='fr');
  document.getElementById('lang-fr').classList.toggle('bg-[#e11d48]', l==='fr');
  document.getElementById('lang-fr').classList.toggle('text-white', l==='fr');
  document.getElementById('lang-fr').classList.toggle('bg-white', l==='en');
  document.getElementById('lang-fr').classList.toggle('text-[#e11d48]', l==='en');
  // For demo: just toggles button color. Real app would translate UI.
}

/** --- MAP --- */
function initMap() {
  const map = L.map('psychologyMap', { zoomControl: false }).setView([54.7, -101], 4);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: ''
  }).addTo(map);
  // Add markers for each tone
  Object.entries(toneMap).forEach(([tone, v]) => {
    const marker = L.circleMarker(v.coords, {
      color: v.color,
      fillColor: v.color,
      fillOpacity: 0.8,
      radius: 15
    }).addTo(map);
    marker.bindPopup(`<strong>${tone.charAt(0).toUpperCase() + tone.slice(1)}</strong><br>Region: ${v.region}`);
  });
}

window.onload = function() {
  renderListings();
  initMap();
  feather.replace();
};
</script>
</body>
</html>

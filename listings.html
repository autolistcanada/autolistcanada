<!DOCTYPE html>
<html lang="en" class="h-full bg-neutral-50">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Listings | AutoList Canada</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Leaflet & Chart.js CDN for analytics panels -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="h-full w-full font-sans leading-relaxed text-neutral-800">

<div class="flex h-screen">

  <!-- 🧭 Left Sidebar -->
  <aside class="relative z-10 flex flex-col w-72 min-w-[16rem] h-full shadow-xl bg-gradient-to-br from-green-900 via-orange-100 to-amber-200">
    <!-- Abstract SVG/Canvas background (example) -->
    <div class="absolute inset-0 pointer-events-none opacity-60">
      <svg viewBox="0 0 400 800" fill="none" class="w-full h-full">
        <ellipse cx="200" cy="150" rx="180" ry="120" fill="#388e3c" opacity="0.16"/>
        <ellipse cx="80" cy="600" rx="120" ry="80" fill="#bc6c25" opacity="0.13"/>
        <ellipse cx="300" cy="400" rx="140" ry="100" fill="#e0c097" opacity="0.11"/>
      </svg>
    </div>
    <div class="relative flex flex-col flex-1 z-10 px-6 py-8">
      <img src="/static/logo.png" alt="AutoList Canada Logo" class="w-14 mb-4"/>
      <img src="/static/title.png" alt="AutoList Canada" class="w-40 mb-10"/>
      <nav class="flex flex-col gap-2 mt-2">
        <a href="/dashboard" class="rounded-lg px-3 py-2 text-lg font-medium hover:bg-green-800/20 transition">Dashboard</a>
        <a href="/listings" class="rounded-lg px-3 py-2 text-lg font-semibold bg-amber-200 text-green-900 shadow-inner cursor-default">Listings</a>
        <a href="/ai-tools" class="rounded-lg px-3 py-2 text-lg font-medium hover:bg-green-800/20">AI Tools</a>
        <a href="/how-it-works" class="rounded-lg px-3 py-2 text-lg font-medium hover:bg-green-800/20">How It Works</a>
        <a href="/faq" class="rounded-lg px-3 py-2 text-lg font-medium hover:bg-green-800/20">FAQ</a>
        <a href="/import" class="rounded-lg px-3 py-2 text-lg font-medium hover:bg-green-800/20">Import</a>
        <a href="/terms" class="rounded-lg px-3 py-2 text-lg font-medium hover:bg-green-800/20">Terms</a>
        <a href="/pricing" class="rounded-lg px-3 py-2 text-lg font-medium hover:bg-green-800/20">Pricing</a>
      </nav>
    </div>
  </aside>

  <main class="flex-1 flex flex-col min-w-0 h-full overflow-hidden">

    <!-- 🧠 Top Control Bar -->
    <section class="sticky top-0 z-20 bg-white shadow-sm flex flex-row items-center px-8 py-4 gap-6 border-b">
      <select class="rounded-md bg-neutral-100 px-3 py-2 text-base focus:ring-2 focus:ring-green-900">
        <option>Marketplace: All</option>
        <option>eBay</option>
        <option>Poshmark</option>
        <option>Shopify</option>
      </select>
      <select class="rounded-md bg-neutral-100 px-3 py-2 text-base focus:ring-2 focus:ring-green-900">
        <option>8 per page</option>
        <option>16 per page</option>
        <option>24 per page</option>
      </select>
      <button class="rounded-md px-4 py-2 bg-green-900 text-white font-medium hover:bg-green-700 transition">Customize</button>
      <button class="rounded-md px-4 py-2 bg-yellow-300 text-yellow-900 font-bold shadow-sm hover:bg-yellow-400 transition ring-2 ring-yellow-400">Bulk Edit</button>
      <button class="rounded-md px-4 py-2 bg-neutral-200 text-green-900 font-medium hover:bg-orange-100">Wide View</button>
      <button class="rounded-md px-4 py-2 bg-neutral-200 text-green-900 font-medium hover:bg-orange-100">Hide Sold</button>
      <span class="ml-auto text-base font-semibold text-neutral-700">Welcome back, <span id="username">Seller</span></span>
    </section>

    <div class="flex-1 flex flex-row gap-6 overflow-hidden px-8 py-4">

      <!-- 📄 Main Listings Table -->
      <section class="flex-1 flex flex-col min-w-0">
        <div class="overflow-x-auto rounded-2xl shadow-lg bg-white">
          <table class="min-w-full text-left border-separate border-spacing-y-2">
            <thead>
              <tr class="text-neutral-700 text-base">
                <th class="px-4 py-3">Image</th>
                <th class="px-4 py-3">Title</th>
                <th class="px-4 py-3">Actions</th>
                <th class="px-4 py-3">SKU</th>
                <th class="px-4 py-3">Price</th>
                <th class="px-4 py-3">Platforms</th>
              </tr>
            </thead>
            <tbody id="listing-rows">
              <!-- JS will inject rows here -->
            </tbody>
          </table>
        </div>

        <!-- 📥 Pagination -->
        <div class="flex justify-center items-center gap-4 mt-6">
          <button class="rounded-full px-4 py-2 bg-neutral-200 hover:bg-green-100 text-green-900 font-medium">Prev</button>
          <span class="text-lg font-semibold">Page <span id="page-num">1</span></span>
          <button class="rounded-full px-4 py-2 bg-neutral-200 hover:bg-green-100 text-green-900 font-medium">Next</button>
        </div>
      </section>

      <!-- 📈 Analytics Panels -->
      <aside class="w-[370px] flex flex-col gap-6">
        <div class="bg-white rounded-2xl shadow-lg border p-5">
          <h3 class="font-bold text-lg mb-4">Sales Psychology Map</h3>
          <div id="map" class="h-48 rounded-lg"></div>
        </div>
        <div class="bg-white rounded-2xl shadow-lg border p-5">
          <h3 class="font-bold text-lg mb-4">World Market Analytics</h3>
          <canvas id="barChart" class="w-full h-36"></canvas>
        </div>
      </aside>
    </div>

    <!-- ⚖️ Footer (Sticky/Full Width) -->
    <footer class="sticky bottom-0 w-full px-8 py-4 bg-neutral-100 flex flex-row items-center justify-between shadow-inner border-t z-40">
      <button class="rounded-xl px-4 py-2 bg-amber-200 text-green-900 font-semibold shadow hover:bg-amber-300 transition">
        Misc AI Listing Adjustments
      </button>
      <div class="flex-1 flex flex-col items-center">
        <span class="text-sm text-neutral-700 font-medium">
          AutoList Canada is PIPEDA compliant. No scraping. All data is private and protected under Canadian law.
        </span>
        <div class="text-xs mt-1 text-neutral-500 flex flex-row gap-3">
          <a href="/terms" class="hover:underline">Terms of Service</a>|
          <a href="/privacy" class="hover:underline">Privacy</a>|
          <a href="/legal" class="hover:underline">Legal</a>|
          <a href="/contact" class="hover:underline">Contact</a>
        </div>
      </div>
      <span class="rounded-xl px-4 py-2 bg-green-900 text-white font-semibold shadow">Our Tools for Listing Dashboard</span>
    </footer>
  </main>
</div>

<!-- Listing Edit Modal -->
<div id="edit-modal" class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-2xl shadow-2xl p-8 w-[420px] flex flex-col gap-4">
    <h2 class="text-xl font-bold mb-2">Edit Listing</h2>
    <!-- Dynamic fields go here -->
    <div id="edit-fields"></div>
    <div class="flex gap-4 justify-end pt-2">
      <button onclick="closeEditModal()" class="px-4 py-2 rounded bg-neutral-200 hover:bg-neutral-300">Cancel</button>
      <button class="px-4 py-2 rounded bg-green-900 text-white hover:bg-green-800">Save</button>
    </div>
  </div>
</div>
<!-- Bulk Edit Modal -->
<div id="bulk-modal" class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-2xl shadow-2xl p-8 w-[480px] flex flex-col gap-4">
    <h2 class="text-xl font-bold mb-2">Bulk Edit Listings</h2>
    <!-- Bulk edit UI here -->
    <p class="text-neutral-600">Bulk update selected fields for multiple listings.</p>
    <div class="flex gap-4 justify-end pt-2">
      <button onclick="closeBulkModal()" class="px-4 py-2 rounded bg-neutral-200 hover:bg-neutral-300">Cancel</button>
      <button class="px-4 py-2 rounded bg-yellow-400 text-yellow-900 font-semibold hover:bg-yellow-500">Apply</button>
    </div>
  </div>
</div>

<!-- Listing Data & Scripts -->
<script>
  // Demo: Simulate loading username and listing data from data.json
  document.getElementById('username').textContent = "MapleSeller";

  const listings = [
    {
      id: 1,
      image: '/static/item1.jpg',
      title: 'Vintage Red Sweater',
      sku: 'CAN123',
      price: 59.99,
      platforms: ['eBay', 'Poshmark'],
      sold: false,
      tags: ['winter', 'vintage'],
    },
    {
      id: 2,
      image: '/static/item2.jpg',
      title: 'Eco-Friendly Sneakers',
      sku: 'CAN124',
      price: 89.00,
      platforms: ['Shopify'],
      sold: true,
      tags: ['shoes', 'eco'],
    }
    // ...more
  ];

  const platformColors = {
    'eBay': 'bg-blue-200 text-blue-900',
    'Poshmark': 'bg-pink-200 text-pink-900',
    'Shopify': 'bg-green-200 text-green-900',
    'Depop': 'bg-orange-100 text-orange-900',
    'Facebook': 'bg-indigo-200 text-indigo-900',
    // Add more as needed
  };

  const platformInitials = {
    'eBay': 'EB',
    'Poshmark': 'PM',
    'Shopify': 'SH',
    'Depop': 'DP',
    'Facebook': 'FB',
  };

  // Render listings
  function renderListings() {
    const tbody = document.getElementById('listing-rows');
    tbody.innerHTML = '';
    listings.forEach(listing => {
      const row = document.createElement('tr');
      row.className = `group cursor-pointer transition-all duration-150 hover:scale-[1.015] hover:shadow-lg rounded-xl ${listing.sold ? 'opacity-50' : ''}`;
      row.onclick = () => openEditModal(listing);

      row.innerHTML = `
        <td class="px-4 py-3">
          <img src="${listing.image}" alt="" class="w-14 h-14 object-cover rounded-lg border"/>
        </td>
        <td class="px-4 py-3 font-semibold ${listing.sold ? 'line-through text-red-600' : ''}">
          ${listing.title}
          ${listing.sold ? `<span class="ml-2 px-2 py-1 rounded bg-red-200 text-red-700 font-bold text-xs align-middle">SOLD</span>` : ''}
        </td>
        <td class="px-4 py-3 flex gap-2">
          <button class="hover:scale-110 transition" title="Edit"><span>✏️</span></button>
          <button class="hover:scale-110 transition" title="Sync"><span>🔄</span></button>
          <button class="hover:scale-110 transition" title="Clone"><span>📋</span></button>
          <button class="hover:scale-110 transition" title="Delete"><span>🗑️</span></button>
        </td>
        <td class="px-4 py-3">${listing.sku}</td>
        <td class="px-4 py-3 font-bold ${listing.sold ? 'text-neutral-400' : 'text-green-900'}">$${listing.price.toFixed(2)}</td>
        <td class="px-4 py-3 flex gap-1">
          ${listing.platforms.map(p =>
            `<span class="px-2 py-1 rounded font-bold text-xs ${platformColors[p]||'bg-neutral-200 text-neutral-800'}">${platformInitials[p]||p.slice(0,2).toUpperCase()}</span>`
          ).join('')}
        </td>
      `;
      tbody.appendChild(row);
    });
  }
  renderListings();

  // Modal logic
  function openEditModal(listing) {
    document.getElementById('edit-modal').classList.remove('hidden');
    document.getElementById('edit-fields').innerHTML = `
      <label class="block font-semibold mb-1">Title</label>
      <input class="w-full rounded-md border px-3 py-2 mb-3" value="${listing.title}">
      <label class="block font-semibold mb-1">Price</label>
      <input class="w-full rounded-md border px-3 py-2 mb-3" type="number" value="${listing.price}">
      <label class="block font-semibold mb-1">Tags</label>
      <input class="w-full rounded-md border px-3 py-2 mb-3" value="${listing.tags.join(', ')}">
      <label class="block font-semibold mb-1">Platforms</label>
      <div class="flex gap-2 mb-3">
        ${Object.keys(platformColors).map(key =>
          `<label class="inline-flex items-center gap-1">
            <input type="checkbox" ${listing.platforms.includes(key) ? 'checked' : ''}> ${platformInitials[key]||key}
          </label>`
        ).join('')}
      </div>
    `;
  }
  function closeEditModal() {
    document.getElementById('edit-modal').classList.add('hidden');
  }

  // Bulk Edit
  document.querySelector('button.bg-yellow-300').onclick = function() {
    document.getElementById('bulk-modal').classList.remove('hidden');
  };
  function closeBulkModal() {
    document.getElementById('bulk-modal').classList.add('hidden');
  }

  // Analytics Panels
  // Leaflet map with dummy buyer clusters
  setTimeout(() => {
    const map = L.map('map').setView([56.1304, -106.3468], 4.2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: ''
    }).addTo(map);
    const buyerLocations = [
      {lat: 43.7, lng: -79.4, count: 12}, // Toronto
      {lat: 45.4, lng: -75.7, count: 7}, // Ottawa
      {lat: 49.3, lng: -123.1, count: 9}, // Vancouver
      {lat: 53.5, lng: -113.5, count: 5}, // Edmonton
      {lat: 46.8, lng: -71.2, count: 8} // Quebec City
    ];
    buyerLocations.forEach(loc => {
      L.circle([loc.lat, loc.lng], {
        color: '#388e3c',
        fillColor: '#388e3c',
        fillOpacity: 0.35,
        radius: 23000 + loc.count * 1500
      }).addTo(map);
    });
  }, 350);

  // Chart.js horizontal bar chart for world analytics
  setTimeout(() => {
    const analyticsData = [
      {country: "Canada", value: 120},
      {country: "US", value: 80},
      {country: "UK", value: 22},
      {country: "France", value: 15},
      {country: "Germany", value: 9}
    ];
    new Chart(document.getElementById('barChart').getContext('2d'), {
      type: "bar",
      data: {
        labels: analyticsData.map(a=>a.country),
        datasets: [{
          data: analyticsData.map(a=>a.value),
          backgroundColor: ["#388e3c","#bc6c25","#e0c097","#fbbf24","#a7f3d0"],
        }]
      },
      options: {
        indexAxis: 'y',
        plugins: { legend: { display: false } },
        scales: {
          x: { beginAtZero: true, grid: {display:false} },
          y: { grid: {display:false} }
        }
      }
    });
  }, 350);

</script>
</body>
</html>

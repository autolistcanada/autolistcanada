<!DOCTYPE html>
<html lang="en" class="bg-white h-full" style="background-image: url('listings-background.png'); background-size: cover; background-attachment: fixed;">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>AutoList Canada Listings Dashboard</title>
  <!-- Google Fonts: Inter -->
  <link href="https://fonts.googleapis.com/css?family=Inter:400,500,600,700&display=swap" rel="stylesheet">
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { font-family: 'Inter', sans-serif; }
    .sidebar-link.active, .sidebar-link:hover { background: #f59e42; color: white; }
    .tone-Cozy { background: #f59e42; color: white; }
    .tone-Luxury { background: #23b56b; color: white; }
    .tone-Minimalist { background: #f3f4f6; color: #374151; }
    .tone-Budget { background: #fbbf24; color: white; }
    .tone-Warm { background: #fb7185; color: white; }
    .status-synced { color: #23b56b; }
    .status-notlisted { color: #ef4444; }
    .status-syncing { color: #f59e42; animation: spin 1s linear infinite; }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    .custom-scrollbar::-webkit-scrollbar { width: 8px; background: #f3f4f6; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 6px; }
  </style>
</head>
<body class="min-h-screen flex bg-white bg-opacity-90">
  <!-- Sidebar -->
  <aside class="fixed left-0 top-0 h-full w-64 z-20 bg-white bg-opacity-95 shadow-lg flex flex-col items-center py-6 border-r border-gray-200">
    <div class="mb-8 flex flex-col items-center">
      <img src="https://autolistcanada.s3.ca-central-1.amazonaws.com/logo.png" alt="AutoList Canada Logo" class="w-28 mb-2" />
      <span class="font-bold text-xl text-orange-500">AutoList Canada</span>
    </div>
    <nav class="flex-1 w-full">
      <ul class="flex flex-col gap-1 px-4 text-lg font-medium">
        <li><a href="#" class="sidebar-link flex items-center px-4 py-2 rounded-lg transition active">üè† Home</a></li>
        <li><a href="#" class="sidebar-link flex items-center px-4 py-2 rounded-lg transition">üìä Dashboard</a></li>
        <li><a href="#" class="sidebar-link flex items-center px-4 py-2 rounded-lg transition">üìã Listings</a></li>
        <li><a href="#" class="sidebar-link flex items-center px-4 py-2 rounded-lg transition">ü§ñ AI Tools</a></li>
        <li><a href="#" class="sidebar-link flex items-center px-4 py-2 rounded-lg transition">‚ùì How It Works</a></li>
        <li><a href="#" class="sidebar-link flex items-center px-4 py-2 rounded-lg transition">üí° FAQ</a></li>
        <li><a href="#" class="sidebar-link flex items-center px-4 py-2 rounded-lg transition">‚¨ÜÔ∏è Listing Import</a></li>
        <li><a href="#" class="sidebar-link flex items-center px-4 py-2 rounded-lg transition">üìÑ Terms</a></li>
        <li><a href="#" class="sidebar-link flex items-center px-4 py-2 rounded-lg transition">üîí Privacy</a></li>
      </ul>
    </nav>
    <!-- Language Switcher -->
    <div class="mt-6 flex gap-2 items-center">
      <button id="lang-en" class="px-3 py-1 rounded text-sm font-semibold border border-orange-400 text-orange-600 bg-white focus:outline-none focus:ring-2 focus:ring-orange-400" aria-label="Switch to English">EN</button>
      <button id="lang-fr" class="px-3 py-1 rounded text-sm font-semibold border border-green-400 text-green-600 bg-white focus:outline-none focus:ring-2 focus:ring-green-400" aria-label="Passer en fran√ßais">FR</button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 ml-64 min-h-screen flex flex-col">
    <!-- Header -->
    <header class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 px-8 py-6">
      <div>
        <h1 class="text-3xl font-bold text-gray-800">Listings Dashboard</h1>
        <p class="text-gray-500 text-md mt-1">Sync and manage your marketplace listings in one place.</p>
      </div>
      <!-- Filters -->
      <div class="flex flex-wrap gap-3 items-center">
        <input type="text" id="search" class="px-3 py-2 rounded bg-white border border-gray-200 shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-orange-200" placeholder="üîç Search listings..." aria-label="Search listings">
        <select id="toneFilter" class="px-3 py-2 rounded bg-white border border-gray-200 text-gray-700 focus:outline-none focus:ring-2 focus:ring-orange-200" aria-label="Filter by Tone">
          <option value="">All Tones</option>
          <option value="Cozy">Cozy</option>
          <option value="Luxury">Luxury</option>
          <option value="Minimalist">Minimalist</option>
          <option value="Budget">Budget</option>
          <option value="Warm">Warm</option>
        </select>
        <select id="platformFilter" class="px-3 py-2 rounded bg-white border border-gray-200 text-gray-700 focus:outline-none focus:ring-2 focus:ring-green-200" aria-label="Filter by Platform">
          <option value="">All Platforms</option>
          <option value="eBay">eBay</option>
          <option value="Etsy">Etsy</option>
          <option value="Poshmark">Poshmark</option>
          <option value="Depop">Depop</option>
          <option value="Shopify">Shopify</option>
          <option value="Instagram">Instagram</option>
          <option value="Facebook">Facebook</option>
          <option value="TikTok">TikTok</option>
        </select>
      </div>
    </header>

    <!-- Listings Table -->
    <section class="flex-1 px-8 pb-8 custom-scrollbar overflow-x-auto">
      <table class="min-w-full bg-white rounded-2xl shadow-xl border-collapse">
        <thead>
          <tr class="text-left text-gray-600 text-sm">
            <th class="px-4 py-3">
              <input type="checkbox" id="select-all" aria-label="Select all listings" />
            </th>
            <th class="px-4 py-3">Image</th>
            <th class="px-4 py-3">Title</th>
            <th class="px-4 py-3">AI</th>
            <th class="px-4 py-3">SKU</th>
            <th class="px-4 py-3">Price (CAD)</th>
            <th class="px-4 py-3">Tones</th>
            <th class="px-4 py-3">Platforms</th>
            <th class="px-4 py-3">Actions</th>
          </tr>
        </thead>
        <tbody id="listing-tbody" class="text-base font-medium text-gray-800">
          <!-- Populated by JS -->
        </tbody>
      </table>
    </section>

    <!-- Buyer Psychology Map -->
    <section class="px-8 pt-8 pb-4">
      <h2 class="text-xl font-bold text-gray-800 mb-2">Buyer Psychology Map</h2>
      <div class="flex flex-col md:flex-row gap-6 items-start">
        <div class="relative w-[375px] h-[250px] bg-white rounded-lg shadow-lg overflow-hidden">
          <img src="https://upload.wikimedia.org/wikipedia/commons/d/d9/Blank_map_of_Canada.png" alt="Canada Map" class="absolute inset-0 w-full h-full object-contain" />
          <!-- Bubble Overlays (JS) -->
          <svg id="map-bubbles" class="absolute inset-0 w-full h-full pointer-events-none"></svg>
        </div>
        <div class="flex flex-col gap-2">
          <span class="inline-flex items-center gap-2"><span class="inline-block w-4 h-4 rounded-full bg-orange-400"></span> Cozy</span>
          <span class="inline-flex items-center gap-2"><span class="inline-block w-4 h-4 rounded-full bg-pink-400"></span> Warm</span>
          <span class="inline-flex items-center gap-2"><span class="inline-block w-4 h-4 rounded-full bg-gray-200 border"></span> Minimalist</span>
          <span class="inline-flex items-center gap-2"><span class="inline-block w-4 h-4 rounded-full bg-green-500"></span> Luxury</span>
          <span class="inline-flex items-center gap-2"><span class="inline-block w-4 h-4 rounded-full bg-yellow-400"></span> Budget</span>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="w-full px-8 py-4 bg-white bg-opacity-80 border-t flex flex-col md:flex-row items-center justify-between gap-4 mt-4 rounded-t-2xl">
      <div class="flex gap-4">
        <img src="https://cdn-icons-png.flaticon.com/512/197/197430.png" alt="Canadian Owned" class="w-7 h-7" title="Canadian Owned" />
        <span class="inline-flex items-center gap-1 bg-green-100 text-green-700 rounded-full px-3 py-1 text-xs font-semibold">
          <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 12l2 2l4-4"></path></svg> AI-Powered Tools
        </span>
        <span class="inline-flex items-center gap-1 bg-orange-100 text-orange-700 rounded-full px-3 py-1 text-xs font-semibold">
          <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v.01"></path><path d="M12 8v4"></path></svg> Privacy First
        </span>
      </div>
      <span class="text-xs text-gray-500">&copy; 2025 AutoList Canada. All rights reserved.</span>
    </footer>
  </main>

  <!-- Listing Detail Modal -->
  <div id="listing-modal" class="fixed inset-0 z-50 bg-black bg-opacity-40 flex items-center justify-center hidden">
    <div class="bg-white rounded-2xl shadow-2xl p-8 w-[90vw] max-w-lg relative">
      <button id="close-modal" class="absolute top-4 right-4 text-gray-400 hover:text-orange-500" aria-label="Close modal">&times;</button>
      <h3 id="modal-title" class="text-2xl font-bold text-gray-800 mb-2"></h3>
      <img id="modal-image" class="w-32 h-32 object-cover rounded mb-3" src="" alt="Listing preview" />
      <div class="mb-2 text-gray-600 text-sm">SKU: <span id="modal-sku"></span></div>
      <div class="mb-2 text-gray-600 text-sm">Price: $<span id="modal-price"></span> CAD</div>
      <div class="mb-2 flex gap-2" id="modal-tones"></div>
      <div class="mb-2" id="modal-platforms"></div>
      <div class="text-gray-700" id="modal-description"></div>
    </div>
  </div>

  <script>
    // --- Data Section ---
    const listings = [
      {
        id: 1,
        image: "https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=facearea&w=128&q=80",
        title: "Handmade Wool Mittens",
        sku: "MTN-001",
        price: "34.99",
        tones: ["Cozy", "Warm"],
        description: "Ultra-soft, eco-friendly wool mittens for Canadian winters.",
        platforms: {
          "eBay": { status: "synced", updated: "2h ago" },
          "Etsy": { status: "synced", updated: "35m ago" },
          "Poshmark": { status: "notlisted", updated: null },
          "Depop": { status: "syncing", updated: null },
          "Shopify": { status: "synced", updated: "1h ago" },
          "Instagram": { status: "notlisted", updated: null },
          "Facebook": { status: "synced", updated: "15m ago" },
          "TikTok": { status: "notlisted", updated: null }
        }
      },
      {
        id: 2,
        image: "https://images.unsplash.com/photo-1519985176271-adb1088fa94c?auto=format&fit=crop&w=128&q=80",
        title: "Organic Cotton Throw Blanket",
        sku: "THR-734",
        price: "59.00",
        tones: ["Minimalist"],
        description: "Soft, large throw blanket. Sustainably sourced.",
        platforms: {
          "eBay": { status: "notlisted", updated: null },
          "Etsy": { status: "synced", updated: "10m ago" },
          "Poshmark": { status: "syncing", updated: null },
          "Depop": { status: "notlisted", updated: null },
          "Shopify": { status: "synced", updated: "8m ago" },
          "Instagram": { status: "synced", updated: "3m ago" },
          "Facebook": { status: "notlisted", updated: null },
          "TikTok": { status: "notlisted", updated: null }
        }
      },
      {
        id: 3,
        image: "https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=128&q=80",
        title: "Luxury Scented Soy Candle",
        sku: "CND-455",
        price: "27.50",
        tones: ["Luxury"],
        description: "Hand-poured, non-toxic soy candle. 60hr burn.",
        platforms: {
          "eBay": { status: "syncing", updated: null },
          "Etsy": { status: "notlisted", updated: null },
          "Poshmark": { status: "synced", updated: "1h ago" },
          "Depop": { status: "synced", updated: "2h ago" },
          "Shopify": { status: "synced", updated: "10m ago" },
          "Instagram": { status: "notlisted", updated: null },
          "Facebook": { status: "synced", updated: "2m ago" },
          "TikTok": { status: "notlisted", updated: null }
        }
      },
      {
        id: 4,
        image: "https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=128&q=80",
        title: "Budget-Friendly Ceramic Mug",
        sku: "MUG-888",
        price: "12.90",
        tones: ["Budget", "Warm"],
        description: "Durable mug, dishwasher safe. Best value for home or gifts.",
        platforms: {
          "eBay": { status: "notlisted", updated: null },
          "Etsy": { status: "notlisted", updated: null },
          "Poshmark": { status: "synced", updated: "20m ago" },
          "Depop": { status: "synced", updated: "25m ago" },
          "Shopify": { status: "synced", updated: "5m ago" },
          "Instagram": { status: "synced", updated: "1m ago" },
          "Facebook": { status: "notlisted", updated: null },
          "TikTok": { status: "syncing", updated: null }
        }
      }
    ];

    const platformIcons = {
      "eBay": "https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/ebay.svg",
      "Etsy": "https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/etsy.svg",
      "Poshmark": "https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/poshmark.svg",
      "Depop": "https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/depop.svg",
      "Shopify": "https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/shopify.svg",
      "Instagram": "https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg",
      "Facebook": "https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/facebook.svg",
      "TikTok": "https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg"
    };

    const tonesColor = {
      "Cozy": "tone-Cozy",
      "Luxury": "tone-Luxury",
      "Minimalist": "tone-Minimalist",
      "Budget": "tone-Budget",
      "Warm": "tone-Warm"
    };

    // --- Helper Functions ---
    function getStatusIcon(status) {
      if (status === "synced")    return `<span class="status-synced" title="Synced"><svg class="w-5 h-5 inline" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7" /></svg></span>`;
      if (status === "notlisted") return `<span class="status-notlisted" title="Not Listed"><svg class="w-5 h-5 inline" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12" /></svg></span>`;
      if (status === "syncing")   return `<span class="status-syncing" title="Syncing"><svg class="w-5 h-5 inline animate-spin" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke-dasharray="80" stroke-dashoffset="60"/></svg></span>`;
      return "";
    }

    function getStatusTooltip(platform, data) {
      if (data.status === "synced") return `${platform} ‚Äì Synced ${data.updated}`;
      if (data.status === "notlisted") return `${platform} ‚Äì Not listed`;
      if (data.status === "syncing") return `${platform} ‚Äì Sync in progress`;
      return platform;
    }

    // --- Listing Table Rendering ---
    function renderListings() {
      const tbody = document.getElementById('listing-tbody');
      tbody.innerHTML = '';
      let filtered = listings
        .filter(l => {
          const search = document.getElementById('search').value.trim().toLowerCase();
          if (search) {
            return l.title.toLowerCase().includes(search) || l.sku.toLowerCase().includes(search);
          }
          return true;
        })
        .filter(l => {
          const tone = document.getElementById('toneFilter').value;
          if (tone) return l.tones.includes(tone);
          return true;
        })
        .filter(l => {
          const plat = document.getElementById('platformFilter').value;
          if (plat) return l.platforms[plat]?.status === "synced";
          return true;
        });

      for (const listing of filtered) {
        const toneChips = listing.tones.map(tone =>
          `<span class="inline-block px-2 py-1 mr-1 rounded text-xs font-semibold border ${tonesColor[tone]}">${tone}</span>`
        ).join('');
        const platformCells = Object.keys(platformIcons).map(platform => {
          const p = listing.platforms[platform] || { status: "notlisted", updated: null };
          return `
            <span class="inline-block mr-1 align-middle" title="${getStatusTooltip(platform, p)}">
              <img src="${platformIcons[platform]}" alt="${platform}" class="w-5 h-5 inline-block align-middle" />
              ${getStatusIcon(p.status)}
            </span>`;
        }).join('');
        tbody.innerHTML += `
          <tr class="hover:bg-orange-50 transition-all group">
            <td class="px-4 py-3">
              <input type="checkbox" class="row-checkbox" aria-label="Select listing ${listing.title}">
            </td>
            <td class="px-4 py-3">
              <img src="${listing.image}" alt="Preview" class="w-14 h-14 rounded shadow object-cover lazyload" loading="lazy">
            </td>
            <td class="px-4 py-3 font-semibold cursor-pointer hover:underline text-orange-600 title-cell" data-id="${listing.id}" tabindex="0">${listing.title}</td>
            <td class="px-4 py-3">
              <button class="ai-suggest-btn px-2 py-1 rounded bg-orange-100 hover:bg-orange-200 text-orange-600 font-semibold transition focus:outline-none" data-id="${listing.id}" aria-label="AI Suggest new title">‚ö°</button>
            </td>
            <td class="px-4 py-3">${listing.sku}</td>
            <td class="px-4 py-3">$${listing.price}</td>
            <td class="px-4 py-3">${toneChips}</td>
            <td class="px-4 py-3">${platformCells}</td>
            <td class="px-4 py-3 flex gap-1">
              <button class="edit-btn px-2 py-1 rounded bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold focus:outline-none" aria-label="Edit listing">‚úèÔ∏è</button>
              <button class="delete-btn px-2 py-1 rounded bg-red-100 hover:bg-red-200 text-red-600 font-semibold focus:outline-none" aria-label="Delete listing">üóëÔ∏è</button>
              <button class="duplicate-btn px-2 py-1 rounded bg-green-100 hover:bg-green-200 text-green-600 font-semibold focus:outline-none" aria-label="Duplicate listing">üìã</button>
            </td>
          </tr>
        `;
      }
    }

    // --- Modal Logic ---
    function showModal(listing) {
      document.getElementById('modal-title').textContent = listing.title;
      document.getElementById('modal-image').src = listing.image;
      document.getElementById('modal-sku').textContent = listing.sku;
      document.getElementById('modal-price').textContent = listing.price;
      document.getElementById('modal-description').textContent = listing.description;
      document.getElementById('modal-tones').innerHTML = listing.tones.map(tone =>
        `<span class="inline-block px-2 py-1 mr-1 rounded text-xs font-semibold border ${tonesColor[tone]}">${tone}</span>`
      ).join('');
      document.getElementById('modal-platforms').innerHTML = Object.keys(platformIcons).map(platform => {
        const p = listing.platforms[platform] || { status: "notlisted", updated: null };
        return `
          <span class="inline-block mr-1 align-middle" title="${getStatusTooltip(platform, p)}">
            <img src="${platformIcons[platform]}" alt="${platform}" class="w-5 h-5 inline-block align-middle" />
            ${getStatusIcon(p.status)}
          </span>`;
      }).join('');
      document.getElementById('listing-modal').classList.remove('hidden');
      document.getElementById('close-modal').focus();
    }

    // --- AI Suggest Logic ---
    function generateAiTitle(title, tones) {
      // Simulate smart, tone-based AI suggestion
      let newTitle = title;
      if (tones.includes("Cozy"))      newTitle = "Cozy " + title.replace(/^(Cozy |Luxury |Minimalist |Budget |Warm )/, "");
      if (tones.includes("Luxury"))    newTitle = "Luxury " + title.replace(/^(Cozy |Luxury |Minimalist |Budget |Warm )/, "");
      if (tones.includes("Minimalist"))newTitle = "Minimalist " + title.replace(/^(Cozy |Luxury |Minimalist |Budget |Warm )/, "");
      if (tones.includes("Budget"))    newTitle = "Budget " + title.replace(/^(Cozy |Luxury |Minimalist |Budget |Warm )/, "");
      if (tones.includes("Warm"))      newTitle = "Warm " + title.replace(/^(Cozy |Luxury |Minimalist |Budget |Warm )/, "");
      if (newTitle === title) newTitle += " ‚Äì Loved in Canada";
      return newTitle;
    }

    function setupAiSuggest() {
      document.querySelectorAll('.ai-suggest-btn').forEach(btn => {
        btn.onclick = function(e) {
          const id = +btn.dataset.id;
          const row = btn.closest('tr');
          const cell = row.querySelector('.title-cell');
          const origTitle = cell.textContent;
          const listing = listings.find(l => l.id === id);
          const aiTitle = generateAiTitle(listing.title, listing.tones);
          if (cell.querySelector('.ai-apply')) return; // already suggested

          // Replace title cell with suggestion and Apply/Undo
          cell.innerHTML = `
            <span class="text-orange-700 font-bold">${aiTitle}</span>
            <button class="ai-apply ml-2 px-2 py-1 rounded bg-green-100 text-green-700 font-semibold text-xs focus:outline-none" aria-label="Apply AI suggestion">Apply</button>
            <button class="ai-undo ml-1 px-2 py-1 rounded bg-gray-100 text-gray-700 font-semibold text-xs focus:outline-none" aria-label="Undo AI suggestion">Undo</button>
          `;
          cell.querySelector('.ai-apply').onclick = function() {
            listing.title = aiTitle;
            renderListings();
            setupUiHandlers();
          };
          cell.querySelector('.ai-undo').onclick = function() {
            cell.textContent = origTitle;
          };
        };
      });
    }

    // --- Language Switcher ---
    function setupLangSwitcher() {
      document.getElementById('lang-en').onclick = () => setLang('en');
      document.getElementById('lang-fr').onclick = () => setLang('fr');
    }
    function setLang(lang) {
      // For production, use i18n, but here is a minimal example
      if (lang === 'fr') {
        document.querySelector('h1').textContent = "Tableau de bord des annonces";
        document.querySelector('header p').textContent = "Synchronisez et g√©rez vos annonces de march√© en un seul endroit.";
        document.getElementById('search').placeholder = "üîç Rechercher des annonces...";
        document.getElementById('toneFilter').options[0].text = "Tous les tons";
        document.getElementById('toneFilter').options[1].text = "Chaleureux";
        document.getElementById('toneFilter').options[2].text = "Luxe";
        document.getElementById('toneFilter').options[3].text = "Minimaliste";
        document.getElementById('toneFilter').options[4].text = "√âconomique";
        document.getElementById('toneFilter').options[5].text = "Chaud";
        document.getElementById('platformFilter').options[0].text = "Toutes les plateformes";
        // ...additional translation for the rest of the UI...
      } else {
        document.querySelector('h1').textContent = "Listings Dashboard";
        document.querySelector('header p').textContent = "Sync and manage your marketplace listings in one place.";
        document.getElementById('search').placeholder = "üîç Search listings...";
        document.getElementById('toneFilter').options[0].text = "All Tones";
        document.getElementById('toneFilter').options[1].text = "Cozy";
        document.getElementById('toneFilter').options[2].text = "Luxury";
        document.getElementById('toneFilter').options[3].text = "Minimalist";
        document.getElementById('toneFilter').options[4].text = "Budget";
        document.getElementById('toneFilter').options[5].text = "Warm";
        document.getElementById('platformFilter').options[0].text = "All Platforms";
      }
    }

    // --- Buyer Psychology Map Bubbles ---
    function renderMapBubbles() {
      // Example: draw bubbles for tones in major provinces
      // Coordinates are [cx, cy, r, color] for SVG over 375x250 img
      const bubbles = [
        // [x, y, r, color, tone]
        [110,155,28,'#f59e42','Cozy'],    // Ontario
        [180,65,18,'#fb7185','Warm'],     // Quebec
        [55,110,16,'#23b56b','Luxury'],   // BC
        [220,180,12,'#fbbf24','Budget'],  // Manitoba
        [300,80,22,'#f3f4f6','Minimalist']// Atlantic
      ];
      const svg = document.getElementById('map-bubbles');
      svg.innerHTML = bubbles.map(([x,y,r,c,_]) =>
        `<circle cx="${x}" cy="${y}" r="${r}" fill="${c}" fill-opacity="0.45" />`
      ).join('');
    }

    // --- Event Handlers for UI ---
    function setupUiHandlers() {
      // Title modal
      document.querySelectorAll('.title-cell').forEach(cell => {
        cell.onclick = function() {
          const id = +cell.dataset.id;
          const listing = listings.find(l => l.id === id);
          showModal(listing);
        };
        cell.onkeydown = function(e) {
          if (e.key === 'Enter' || e.key === ' ') {
            const id = +cell.dataset.id;
            const listing = listings.find(l => l.id === id);
            showModal(listing);
          }
        };
      });
      document.getElementById('close-modal').onclick = () => {
        document.getElementById('listing-modal').classList.add('hidden');
      };
      setupAiSuggest();
    }

    // --- Bulk Select ---
    document.addEventListener('DOMContentLoaded', () => {
      renderListings();
      setupUiHandlers();
      setupLangSwitcher();
      renderMapBubbles();

      document.getElementById('search').oninput =
      document.getElementById('toneFilter').onchange =
      document.getElementById('platformFilter').onchange = () => {
        renderListings();
        setupUiHandlers();
      };
      document.getElementById('select-all').onchange = function() {
        document.querySelectorAll('.row-checkbox').forEach(cb => cb.checked = this.checked);
      };
    });
  </script>
</body>
</html>

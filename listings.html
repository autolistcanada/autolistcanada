<!DOCTYPE html>
<html lang="en" class="bg-gray-50">
<head>
  <meta charset="UTF-8" />
  <title>Listings Dashboard ‚Äì AutoList Canada</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Leaflet CSS & JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Heroicons for icons -->
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    .sidebar-bg {
      background-image: url('sidebar-background.png');
      background-size: cover;
      background-repeat: no-repeat;
    }
    .tone-badge {
      @apply px-2 py-0.5 rounded text-xs font-semibold uppercase;
    }
    /* Custom scrollbar for sidebar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-thumb { background: #e1e1e1; border-radius: 8px; }
  </style>
</head>
<body class="font-sans antialiased flex bg-gray-50">

<!-- Sidebar -->
<aside class="sidebar-bg fixed top-0 left-0 h-full w-64 flex flex-col justify-between z-30 shadow-lg">
  <div>
    <div class="flex flex-col items-center mt-7 mb-4">
      <img src="autolist-logo.png" alt="AutoList Logo" class="w-14 h-14 mb-3" />
      <img src="autolist-title.png" alt="AutoList Canada" class="w-32 mb-8" />
    </div>
    <!-- Sidebar Links -->
    <nav class="px-6">
      <ul class="space-y-1 font-medium text-gray-100">
        <li><a href="#" class="flex items-center py-2 px-3 rounded hover:bg-orange-50 hover:text-orange-600 transition"><span data-feather="home" class="mr-2"></span>Home</a></li>
        <li><a href="#" class="flex items-center py-2 px-3 rounded hover:bg-orange-50 hover:text-orange-600 transition"><span data-feather="bar-chart-2" class="mr-2"></span>Dashboard</a></li>
        <li>
          <a href="#" class="flex items-center py-2 px-3 rounded bg-orange-600 text-white font-semibold shadow hover:bg-orange-700 transition">
            <span data-feather="list" class="mr-2"></span>Listings
          </a>
        </li>
        <li><a href="#" class="flex items-center py-2 px-3 rounded hover:bg-orange-50 hover:text-orange-600 transition"><span data-feather="cpu" class="mr-2"></span>AI Tools</a></li>
        <li><a href="#" class="flex items-center py-2 px-3 rounded hover:bg-orange-50 hover:text-orange-600 transition"><span data-feather="info" class="mr-2"></span>How It Works</a></li>
        <li><a href="#" class="flex items-center py-2 px-3 rounded hover:bg-orange-50 hover:text-orange-600 transition"><span data-feather="help-circle" class="mr-2"></span>FAQ</a></li>
        <li><a href="#" class="flex items-center py-2 px-3 rounded hover:bg-orange-50 hover:text-orange-600 transition"><span data-feather="upload" class="mr-2"></span>Import</a></li>
        <li><a href="#" class="flex items-center py-2 px-3 rounded hover:bg-orange-50 hover:text-orange-600 transition"><span data-feather="file-text" class="mr-2"></span>Terms</a></li>
        <li><a href="#" class="flex items-center py-2 px-3 rounded hover:bg-orange-50 hover:text-orange-600 transition"><span data-feather="shield" class="mr-2"></span>Privacy</a></li>
      </ul>
    </nav>
  </div>
  <!-- Language toggle -->
  <div class="px-6 pb-7">
    <div class="flex items-center justify-start space-x-2 text-gray-200 text-sm">
      <span class="font-bold">CA</span>
      <button class="px-2 py-1 rounded bg-gray-800 hover:bg-orange-500 focus:bg-orange-600 transition">EN</button>
      <span>/</span>
      <button class="px-2 py-1 rounded hover:bg-orange-500 focus:bg-orange-600 transition">FR</button>
    </div>
  </div>
</aside>

<!-- Main Content Wrapper -->
<div class="flex flex-col flex-1 ml-64 min-h-screen">

  <!-- Header Section -->
  <header class="flex flex-wrap items-center justify-between px-10 py-6 border-b border-gray-200 bg-white shadow-sm">
    <!-- Search and filters -->
    <div class="flex items-center space-x-4 flex-1">
      <input id="searchInput" type="text" placeholder="Search listings..." class="w-64 px-5 py-2.5 rounded-full border border-gray-200 focus:border-orange-400 outline-none text-gray-700 shadow-sm" oninput="filterListings()" />
      <select id="platformFilter" class="px-3 py-2 rounded border border-gray-200 text-gray-600 focus:border-orange-400 outline-none" onchange="filterListings()">
        <option value="">All Platforms</option>
        <option value="ebay">eBay</option>
        <option value="poshmark">Poshmark</option>
        <option value="facebook">Facebook</option>
      </select>
      <select id="toneFilter" class="px-3 py-2 rounded border border-gray-200 text-gray-600 focus:border-orange-400 outline-none" onchange="filterListings()">
        <option value="">All Buyer Intents</option>
        <option value="Cozy">Cozy</option>
        <option value="Luxury">Luxury</option>
        <option value="Eco">Eco</option>
        <option value="Vintage">Vintage</option>
        <option value="Budget">Budget</option>
      </select>
      <label class="flex items-center ml-3 space-x-2 cursor-pointer">
        <input type="checkbox" id="hideSold" class="accent-orange-500 w-5 h-5" onchange="filterListings()" />
        <span class="text-gray-700 font-medium">Hide Sold</span>
      </label>
      <div class="flex items-center ml-6">
        <button id="listViewBtn" class="px-2 py-1 mr-2 rounded-full border border-gray-300 bg-orange-600 text-white font-bold shadow hover:bg-orange-700 transition" onclick="toggleView('list')"><span data-feather="list"></span></button>
        <button id="gridViewBtn" class="px-2 py-1 rounded-full border border-gray-300 text-gray-500 hover:bg-orange-200 hover:text-orange-700 transition" onclick="toggleView('grid')"><span data-feather="grid"></span></button>
      </div>
    </div>
    <!-- Sync status buttons -->
    <div class="flex items-center space-x-2">
      <button onclick="connectMarketplace('ebay')" id="ebayConnectBtn" class="flex items-center px-4 py-2 rounded bg-blue-600 text-white font-semibold hover:bg-blue-700 transition shadow">
        <span data-feather="check-circle" class="mr-2"></span>Connect eBay
      </button>
      <button onclick="connectMarketplace('poshmark')" id="poshmarkConnectBtn" class="flex items-center px-4 py-2 rounded bg-pink-600 text-white font-semibold hover:bg-pink-700 transition shadow">
        <span data-feather="check-circle" class="mr-2"></span>Connect Poshmark
      </button>
      <button onclick="connectMarketplace('facebook')" id="facebookConnectBtn" class="flex items-center px-4 py-2 rounded bg-gray-900 text-white font-semibold hover:bg-gray-800 transition shadow">
        <span data-feather="check-circle" class="mr-2"></span>Connect Facebook
      </button>
    </div>
  </header>

  <!-- Bulk Listings Sync / Table -->
  <main class="flex-1 px-10 py-6 bg-gray-50">
    <!-- Bulk sync alert if not connected -->
    <div id="bulkSyncAlert" class="hidden mb-6">
      <div class="flex items-center bg-orange-100 border-l-4 border-orange-500 text-orange-800 p-5 rounded">
        <span data-feather="alert-triangle" class="mr-3"></span>
        <div>
          <div class="font-bold mb-1">Connect to eBay to import your listings</div>
          <button onclick="connectMarketplace('ebay')" class="mt-1 px-3 py-1.5 bg-orange-500 text-white font-semibold rounded hover:bg-orange-600 transition">Connect Now</button>
        </div>
      </div>
    </div>
    <!-- Listings Table -->
    <div id="listingsSection">
      <section id="listingsTableView">
        <table class="min-w-full table-auto border-separate border-spacing-y-2 shadow bg-white rounded-lg overflow-hidden">
          <thead>
            <tr class="text-left text-xs font-bold tracking-widest text-gray-600 uppercase bg-gray-100">
              <th class="pl-5 py-3">Image</th>
              <th class="py-3">Title</th>
              <th class="py-3">Actions</th>
              <th class="py-3">SKU</th>
              <th class="py-3">Price</th>
              <th class="py-3">Platforms</th>
              <th class="py-3 pr-5">Tone</th>
            </tr>
          </thead>
          <tbody id="listingsTableBody" class="text-gray-700 text-sm"></tbody>
        </table>
      </section>
      <section id="listingsGridView" class="hidden">
        <div id="gridListings" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-6"></div>
      </section>
    </div>
    <!-- Buyer Psychology Map -->
    <section class="mt-10 max-w-xl bg-white rounded-lg shadow p-6">
      <div class="flex items-center mb-4">
        <span data-feather="map" class="mr-3 text-orange-500"></span>
        <h2 class="font-bold text-lg text-gray-700">Buyer Psychology Map</h2>
      </div>
      <div id="buyerMap" class="w-full h-72 rounded shadow border border-gray-200"></div>
      <div class="flex flex-wrap mt-4 space-x-6 text-sm">
        <div class="flex items-center"><span class="text-blue-500 mr-1">üßä</span>Minimalist (BC)</div>
        <div class="flex items-center"><span class="text-orange-500 mr-1">‚òÄÔ∏è</span>Warm (QC)</div>
        <div class="flex items-center"><span class="text-pink-500 mr-1">üß∏</span>Cozy (Prairies)</div>
        <div class="flex items-center"><span class="text-purple-500 mr-1">üíé</span>Luxury (Toronto)</div>
        <div class="flex items-center"><span class="text-green-500 mr-1">üå±</span>Budget (Maritimes)</div>
      </div>
    </section>
  </main>
</div>

<!-- Modals and Drawers (Delete, AI Enhance, Edit) -->
<div id="modalBackdrop" class="hidden fixed inset-0 z-40 bg-black bg-opacity-30 flex items-center justify-center"></div>
<!-- Delete Modal -->
<div id="deleteModal" class="hidden fixed z-50 top-1/2 left-1/2 w-full max-w-sm -translate-x-1/2 -translate-y-1/2 bg-white p-6 rounded-lg shadow-lg">
  <h3 class="font-bold text-lg text-gray-900 mb-3 flex items-center"><span data-feather="trash-2" class="mr-2 text-red-500"></span>Delete Listing</h3>
  <div class="mb-4 text-gray-700">Are you sure you want to delete <span id="deleteTitle" class="font-semibold"></span>? This action can‚Äôt be undone.</div>
  <div class="flex justify-end space-x-2">
    <button onclick="closeDeleteModal()" class="px-4 py-2 rounded bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
    <button onclick="confirmDeleteListing()" class="px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700 font-semibold">Delete</button>
  </div>
</div>
<!-- AI Enhance Modal -->
<div id="aiModal" class="hidden fixed z-50 top-1/2 left-1/2 w-full max-w-lg -translate-x-1/2 -translate-y-1/2 bg-white p-7 rounded-lg shadow-lg">
  <h3 class="font-bold text-lg text-gray-900 mb-3 flex items-center"><span data-feather="zap" class="mr-2 text-orange-500"></span>AI Enhancement</h3>
  <div id="aiSuggestions" class="mb-6 text-gray-700"></div>
  <div class="flex justify-end">
    <button onclick="closeAIModal()" class="px-4 py-2 rounded bg-orange-500 text-white hover:bg-orange-600 font-semibold">Close</button>
  </div>
</div>
<!-- Edit Inline Row Template (hidden for cloning) -->
<table class="hidden"><tbody>
<tr id="editRowTemplate">
  <td class="pl-5 py-2"><img src="" class="w-12 h-12 rounded object-cover border" id="editImg" /></td>
  <td>
    <input type="text" class="border rounded px-2 py-1 w-full" id="editTitle" />
  </td>
  <td class="flex space-x-2">
    <button onclick="saveEditListing(event)" class="px-3 py-1.5 rounded bg-green-500 text-white font-semibold hover:bg-green-600">Save</button>
    <button onclick="cancelEditListing(event)" class="px-3 py-1.5 rounded bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
  </td>
  <td>
    <input type="text" class="border rounded px-2 py-1 w-32" id="editSku" />
  </td>
  <td>
    <input type="text" class="border rounded px-2 py-1 w-20" id="editPrice" />
  </td>
  <td>
    <div class="flex space-x-2" id="editPlatforms"></div>
  </td>
  <td>
    <select id="editTone" class="border rounded px-2 py-1 w-24">
      <option>Cozy</option>
      <option>Luxury</option>
      <option>Eco</option>
      <option>Vintage</option>
      <option>Budget</option>
    </select>
  </td>
</tr>
</tbody></table>

<script>
/* ---- STATE ---- */
let isEbayConnected = true; // Simulate eBay connected
let isPoshmarkConnected = true;
let isFacebookConnected = true;
let listings = [
  {
    title: "Vintage Denim Jacket",
    sku: "CA-JACKET-412",
    price: "$110.00",
    image: "jacket.jpg",
    platforms: ["ebay", "poshmark", "facebook"],
    tone: "Vintage"
  },
  {
    title: "Cozy Fleece Hoodie",
    sku: "CA-HOOD-101",
    price: "$48.99",
    image: "hoodie.jpg",
    platforms: ["ebay"],
    tone: "Cozy"
  },
  {
    title: "Luxury Leather Bag",
    sku: "CA-BAG-309",
    price: "$225.50",
    image: "bag.jpg",
    platforms: ["facebook"],
    tone: "Luxury"
  }
];
let filteredListings = [...listings];
let currentView = 'list';
let listingToDelete = null;
let editingIndex = null;

/* ---- UTILS ---- */
function platformIcon(p) {
  if(p==='ebay') return '<img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/EBay_logo_2012.svg" alt="eBay" class="w-6 h-6 rounded" />';
  if(p==='poshmark') return '<img src="https://seeklogo.com/images/P/poshmark-logo-9F4B5F18A2-seeklogo.com.png" alt="Poshmark" class="w-6 h-6 rounded" />';
  if(p==='facebook') return '<img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" alt="Facebook" class="w-6 h-6 rounded bg-gray-200 p-0.5" />';
  return '';
}
function toneBadge(tone) {
  let map = {
    'Cozy': 'bg-pink-100 text-pink-600',
    'Luxury': 'bg-purple-100 text-purple-700',
    'Eco': 'bg-green-100 text-green-700',
    'Budget': 'bg-green-50 text-green-600',
    'Vintage': 'bg-yellow-100 text-yellow-700',
    'Minimalist': 'bg-blue-100 text-blue-600',
    'Warm': 'bg-orange-100 text-orange-600'
  };
  return `<span class="tone-badge ${map[tone]||'bg-gray-200 text-gray-600'}">${tone}</span>`;
}
function fallbackImg(img) {
  return img && img.trim() ? img : 'https://via.placeholder.com/60x60?text=No+Image';
}

/* ---- MAIN RENDERERS ---- */
function renderListingsTable() {
  const body = document.getElementById('listingsTableBody');
  body.innerHTML = '';
  filteredListings.forEach((listing, i) => {
    if(editingIndex === i) {
      // Inline edit row
      let editRow = document.getElementById('editRowTemplate').cloneNode(true);
      editRow.removeAttribute('id');
      editRow.style.display = '';
      editRow.querySelector('#editImg').src = fallbackImg(listing.image);
      editRow.querySelector('#editTitle').value = listing.title;
      editRow.querySelector('#editSku').value = listing.sku;
      editRow.querySelector('#editPrice').value = listing.price;
      // Platforms
      let platDiv = editRow.querySelector('#editPlatforms');
      ['ebay','poshmark','facebook'].forEach(p=>{
        let chk = document.createElement('input');
        chk.type = 'checkbox';
        chk.checked = listing.platforms.includes(p);
        chk.className = 'accent-orange-500 w-5 h-5 mx-0.5';
        chk.dataset.platform = p;
        platDiv.appendChild(chk);
      });
      // Tone
      editRow.querySelector('#editTone').value = listing.tone;
      // Save/Cancel button events
      editRow.querySelector('button[onclick="saveEditListing(event)"]').onclick = e => saveEditListing(i, e);
      editRow.querySelector('button[onclick="cancelEditListing(event)"]').onclick = e => cancelEditListing(i, e);
      body.appendChild(editRow);
      return;
    }
    let tr = document.createElement('tr');
    tr.className = "rounded bg-white shadow hover:shadow-lg transition";
    tr.innerHTML = `
      <td class="pl-5 py-2"><img src="${fallbackImg(listing.image)}" class="w-12 h-12 rounded object-cover border" /></td>
      <td class="font-semibold">${listing.title}</td>
      <td>
        <div class="flex space-x-2">
          <button onclick="editListing(${i})" class="p-1 rounded hover:bg-orange-100" title="Edit"><span data-feather="edit-3"></span></button>
          <button onclick="openDeleteModal(${i})" class="p-1 rounded hover:bg-red-100" title="Delete"><span data-feather="trash-2" class="text-red-500"></span></button>
          <button onclick="openAIModal(${i})" class="p-1 rounded hover:bg-orange-100" title="AI Enhance"><span data-feather="zap"></span></button>
        </div>
      </td>
      <td>${listing.sku}</td>
      <td class="font-bold">${listing.price}</td>
      <td>
        <div class="flex items-center space-x-1">
          ${['ebay','poshmark','facebook'].map(p=>
            `<input type="checkbox" class="accent-orange-500 w-5 h-5" ${listing.platforms.includes(p)?'checked':''} onclick="togglePlatform(${i},'${p}')" title="${p[0].toUpperCase()+p.slice(1)}" />`
          ).join('')}
        </div>
      </td>
      <td>${toneBadge(listing.tone)}</td>
    `;
    body.appendChild(tr);
  });
  feather.replace();
}

function renderListingsGrid() {
  const grid = document.getElementById('gridListings');
  grid.innerHTML = '';
  filteredListings.forEach((listing, i) => {
    let div = document.createElement('div');
    div.className = "bg-white rounded-xl shadow-lg flex flex-col p-5 items-center hover:shadow-2xl transition";
    div.innerHTML = `
      <img src="${fallbackImg(listing.image)}" class="w-28 h-28 object-cover rounded border mb-3" />
      <div class="font-bold text-lg mb-1 text-center">${listing.title}</div>
      <div class="font-semibold text-orange-600 mb-1">${listing.price}</div>
      <div class="mb-2">${toneBadge(listing.tone)}</div>
      <div class="flex items-center space-x-2 mb-3">
        ${listing.platforms.map(platformIcon).join('')}
      </div>
      <div class="flex space-x-2">
        <button onclick="openAIModal(${i})" class="px-3 py-1 rounded bg-orange-500 text-white text-xs font-bold hover:bg-orange-600 transition">AI Title Fix</button>
        <button onclick="editListing(${i})" class="px-3 py-1 rounded bg-gray-200 text-gray-700 text-xs font-bold hover:bg-gray-300 transition">Edit Description</button>
      </div>
    `;
    grid.appendChild(div);
  });
  feather.replace();
}

/* ---- VIEW TOGGLE ---- */
function toggleView(view) {
  currentView = view;
  document.getElementById('listViewBtn').classList.toggle('bg-orange-600', view==='list');
  document.getElementById('listViewBtn').classList.toggle('text-white', view==='list');
  document.getElementById('listViewBtn').classList.toggle('text-gray-500', view!=='list');
  document.getElementById('gridViewBtn').classList.toggle('bg-orange-600', view==='grid');
  document.getElementById('gridViewBtn').classList.toggle('text-white', view==='grid');
  document.getElementById('gridViewBtn').classList.toggle('text-gray-500', view!=='grid');
  document.getElementById('listingsTableView').classList.toggle('hidden', view!=='list');
  document.getElementById('listingsGridView').classList.toggle('hidden', view!=='grid');
  if(view==='list') renderListingsTable();
  else renderListingsGrid();
}

/* ---- FILTERING ---- */
function filterListings() {
  const search = document.getElementById('searchInput').value.trim().toLowerCase();
  const plat = document.getElementById('platformFilter').value;
  const tone = document.getElementById('toneFilter').value;
  const hideSold = document.getElementById('hideSold').checked;
  filteredListings = listings.filter(l => {
    let match = true;
    if(search && !(l.title.toLowerCase().includes(search) || l.sku.toLowerCase().includes(search))) match = false;
    if(plat && !l.platforms.includes(plat)) match = false;
    if(tone && l.tone !== tone) match = false;
    if(hideSold && l.sold) match = false;
    return match;
  });
  if(currentView === 'list') renderListingsTable();
  else renderListingsGrid();
}

/* ---- PLATFORM TOGGLE ---- */
function togglePlatform(i, p) {
  let idx = listings[i].platforms.indexOf(p);
  if(idx > -1) listings[i].platforms.splice(idx,1);
  else listings[i].platforms.push(p);
  filterListings();
}

/* ---- EDITING ---- */
function editListing(i) {
  editingIndex = i;
  renderListingsTable();
}
function saveEditListing(i, e) {
  const row = e.target.closest('tr');
  listings[i].title = row.querySelector('#editTitle').value;
  listings[i].sku = row.querySelector('#editSku').value;
  listings[i].price = row.querySelector('#editPrice').value;
  let platforms = [];
  row.querySelectorAll('#editPlatforms input[type=checkbox]').forEach(chk=>{
    if(chk.checked) platforms.push(chk.dataset.platform);
  });
  listings[i].platforms = platforms;
  listings[i].tone = row.querySelector('#editTone').value;
  editingIndex = null;
  filterListings();
}
function cancelEditListing(i, e) {
  editingIndex = null;
  renderListingsTable();
}

/* ---- DELETE ---- */
function openDeleteModal(i) {
  listingToDelete = i;
  document.getElementById('deleteTitle').textContent = listings[i].title;
  document.getElementById('modalBackdrop').classList.remove('hidden');
  document.getElementById('deleteModal').classList.remove('hidden');
}
function closeDeleteModal() {
  document.getElementById('modalBackdrop').classList.add('hidden');
  document.getElementById('deleteModal').classList.add('hidden');
  listingToDelete = null;
}
function confirmDeleteListing() {
  if(listingToDelete!=null) {
    listings.splice(listingToDelete, 1);
    filterListings();
  }
  closeDeleteModal();
}

/* ---- AI ENHANCE ---- */
function openAIModal(i) {
  document.getElementById('modalBackdrop').classList.remove('hidden');
  document.getElementById('aiModal').classList.remove('hidden');
  let l = listings[i];
  document.getElementById('aiSuggestions').innerHTML = `
    <div class="mb-3"><strong>AI Suggestions for:</strong> <span class="text-orange-600">${l.title}</span></div>
    <ul class="list-disc pl-5 text-gray-700">
      <li>Optimize title: <em>"${l.title.replace(/(Vintage|Luxury|Cozy|Eco|Budget)/gi, '')} ‚Äì ${l.tone} Style"</em></li>
      <li>Price check: <em>${l.price} is ${Math.random()>0.5?'competitive':'above average'} for ${l.tone} items</em></li>
      <li>Add platform: <em>${['ebay','poshmark','facebook'].filter(p=>!l.platforms.includes(p)).map(p=>p.charAt(0).toUpperCase()+p.slice(1)).join(', ')||'All connected'}</em></li>
      <li>Image quality: <em>${l.image&&l.image!=='https://via.placeholder.com/60x60?text=No+Image'?'Looks good':'Consider adding an image'}</em></li>
    </ul>
  `;
}
function closeAIModal() {
  document.getElementById('modalBackdrop').classList.add('hidden');
  document.getElementById('aiModal').classList.add('hidden');
}

/* ---- MARKETPLACE CONNECT ---- */
function connectMarketplace(market) {
  if(market==='ebay') isEbayConnected = true;
  if(market==='poshmark') isPoshmarkConnected = true;
  if(market==='facebook') isFacebookConnected = true;
  updateBulkSyncAlert();
  filterListings();
}

/* ---- BULK SYNC ALERT ---- */
function updateBulkSyncAlert() {
  if(!isEbayConnected) {
    document.getElementById('bulkSyncAlert').classList.remove('hidden');
    document.getElementById('listingsSection').classList.add('hidden');
  } else {
    document.getElementById('bulkSyncAlert').classList.add('hidden');
    document.getElementById('listingsSection').classList.remove('hidden');
  }
}

/* ---- MAP ---- */
function renderMap() {
  let map = L.map('buyerMap').setView([56.1304, -106.3468], 3.5);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: ''
  }).addTo(map);
  // Emoji markers
  const regions = [
    {lat:53.7267, lng:-127.6476, emoji:'üßä', color:'#60a5fa', text:'Minimalist (BC)'},      // BC
    {lat:52.9399, lng:-73.5491, emoji:'‚òÄÔ∏è', color:'#f59e42', text:'Warm (QC)'},             // Quebec
    {lat:53.9333, lng:-116.5765, emoji:'üß∏', color:'#ec4899', text:'Cozy (Prairies)'},      // Prairies (AB, MB, SK)
    {lat:43.6532, lng:-79.3832, emoji:'üíé', color:'#a78bfa', text:'Luxury (Toronto)'},      // Toronto
    {lat:46.5653, lng:-66.4619, emoji:'üå±', color:'#4ade80', text:'Budget (Maritimes)'}     // Maritimes
  ];
  regions.forEach(r=>{
    L.circle([r.lat, r.lng], {
      color: r.color,
      fillColor: r.color,
      fillOpacity: 0.4,
      radius: 180000
    }).addTo(map).bindTooltip(r.emoji+" "+r.text, {permanent:true, direction:'top', className:'font-bold text-lg'});
  });
}

/* ---- INIT ---- */
window.onload = function() {
  updateBulkSyncAlert();
  feather.replace();
  filterListings();
  renderMap();
  toggleView('list');
};
</script>
</body>
</html>
